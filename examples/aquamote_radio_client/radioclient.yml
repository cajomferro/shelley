name: RadioClient
start_with: [begin, begin_err]
end_with: [begin_err, stopped]
components:
      hc: HTTPClient
      wc: WiFiClient
operations:
    begin:
        next: [stopped, send]
        micro:
          seq: [wc.ssid_joined, wc.connected, hc.connected]
    begin_err:
        next: [begin_err, begin]
        micro:
          xor:
            - seq: [wc.ssid_joined, wc.connected, hc.connect_failed, wc.disconnected, wc.ssid_left]
            - seq: [wc.ssid_joined, wc.connection_timeout]
            - wc.ssid_failed
    stopped:
        next: [begin, begin_err]
        micro:
          seq: [wc.disconnected, hc.disconnected, wc.ssid_left]
    send:
        next: [send_ok, send_err]
        micro:
          xor:
            - hc.get
            - hc.post
    send_ok:
        next: [stopped, send]
        micro:
          seq: [wc.print_data_ready, hc.response200]
    send_err:
        next: [stopped]
        micro:
          xor:
            - seq: [wc.print_data_ready, hc.response401]
            - seq: [wc.print_data_ready, hc.response404]
            - seq: [wc.print_data_ready, hc.response500]
            - wc.print_timeout

#test_micro:
#  ok:
#    valid1: [wc.ssid_joined, wc.connected, hc.connected, hc.get, wc.print_data_ready, hc.response200, wc.disconnected, hc.disconnected, wc.ssid_left]
#  fail:
#    invalid: false
#    empty: []