device:
  name: TrafficLightCtrl
  behavior:
    # normal
    - [normal_red, normal_green]
    - [normal_green, normal_yellow]
    - [normal_yellow, normal_red]
    # normal -> interrupted
    - [normal_red, police_on]
    - [normal_green, police_on]
    - [normal_yellow, police_on]
    - [police_on, interrupted_blinkingyellow]
    # interrupted -> normal
    - [interrupted_blinkingyellow, police_off]
    - [interrupted_black, police_off]
    - [police_off, normal_red]
    # interrupted
    - [interrupted_blinkingyellow, interrupted_black]
    - [interrupted_black, interrupted_blinkingyellow]
  components:
    PoliceInterrupt : PoliceInterrupt # input
    Control: Control # input
    BlinkingYellowTimeout3: Timer
    BlackTimeout4: Timer
    LightCommands: LightCommands # output
  events:
    - police_on:
        start: False
        final: True
        micro: PoliceInterrupt.on
    - police_off:
        start: False
        final: True
        micro: PoliceInterrupt.off
    - normal_red:
        start: True
        final: True
        micro:
          seq:
            - Control.toggle
            - LightCommands.displayRed
    - normal_green:
        start: False
        final: False
        micro: [Control.toggle, LightCommands.displayGreen]
    - normal_yellow:
        start: False
        final: False
        micro: [Control.toggle, LightCommands.displayYellow]
    - interrupted_blinkingyellow:
        start: False
        final: False
        micro:
          seq:
            - BlackTimeout4.timeout
            - LightCommands.displayYellow
    - interrupted_black:
        start: False
        final: False
        micro:
          seq:
            - BlinkingYellowTimeout3.timeout
            - LightCommands.displayNone
