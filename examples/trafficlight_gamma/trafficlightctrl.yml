device:
  name: TrafficLightCtrl
  behavior:
    # normal
    - [normal_red, normal_green]
    - [normal_green, normal_yellow]
    - [normal_yellow, normal_red]
    # normal -> interrupted
    - [normal_red, interrupted_blinkingyellow]
    - [normal_green, interrupted_blinkingyellow]
    - [normal_yellow, interrupted_blinkingyellow]
    # interrupted -> normal
    - [interrupted_blinkingyellow, normal_red]
    - [interrupted_black, normal_red]
    # interrupted
    - [interrupted_black, interrupted_blinkingyellow]
    - [interrupted_blinkingyellow, interrupted_black]
  components:
    PoliceInterrupt : PoliceInterrupt # input
    Control: Control # input
    BlinkingYellowTimeout3: Timer
    BlackTimeout4: Timer
    LightCommands: LightCommands # output
  events:
    - normal_red:
        start: True
        final: True
        micro:
          seq:
            - seq: [BlinkingYellowTimeout3.end, BlackTimeout4.end] # cancel any timer still active
            - xor:
              - PoliceInterrupt.police
              - Control.toggle
            - LightCommands.displayRed
    - normal_green:
        start: False
        final: False
        micro: [Control.toggle, LightCommands.displayGreen]
    - normal_yellow:
        start: False
        final: False
        micro: [Control.toggle, LightCommands.displayYellow]
    - interrupted_blinkingyellow:
        start: False
        final: False
        micro:
          seq:
            - xor:
                - PoliceInterrupt.police
                - BlackTimeout4.timeout
            - LightCommands.displayYellow
            - BlinkingYellowTimeout3.begin
    - interrupted_black:
        start: False
        final: False
        micro:
          seq:
            - xor:
                - PoliceInterrupt.police
                - BlinkingYellowTimeout3.timeout
            - LightCommands.displayNone
            - BlackTimeout4.begin
