device:
  name: Controller
  behavior:
    # operating
    - [operating_init, operating_priority_prepares]
    - [operating_priority_prepares, operating_secondary]
    - [operating_secondary, operating_secondary_prepares]
    - [operating_secondary_prepares, operating_priority]
    - [operating_priority, operating_priority_prepares]
    # interrupted -> operating
    - [interrupted, operating_init]
    # operating -> interrupted
    - [operating_init, interrupted]
    - [operating_priority_prepares, interrupted]
    - [operating_secondary, interrupted]
    - [operating_secondary_prepares, interrupted]
    - [operating_priority, interrupted]
  components:
    SecondaryTimeout2: Timer
    SecondaryPreparesTimeout3: Timer
    PriorityTimeout4: Timer
    InitTimeout5: Timer
    PriorityPreparesTimeout6: Timer
    PriorityControl: Control
    SecondaryControl: Control
	PoliceInterrupt : PoliceInterrupt # input
	PriorityPolice : PoliceInterrupt # output
	SecondaryPolice : PoliceInterrupt # output
  events:
    - operating_init:
        start: True
        final: False
        micro:
          xor:
            - seq: [PriorityControl.toggle, InitTimeout5.begin]
            - seq: [PoliceInterrupt.police, PriorityPolice.police, SecondaryPolice.police] # THIS IS AMBIGUOUS
    - operating_priority_prepares:
        start: False
        final: False
        micro:
          seq: [InitTimeout5.timeout, PriorityControl.toggle, PriorityPreparesTimeout6.begin]
    - operating_secondary:
        start: False
        final: False
        micro:
          seq: [PriorityPreparesTimeout6.timeout, SecondaryControl.toggle, PriorityControl.toggle, SecondaryTimeout2.begin]
    - operating_secondary_prepares:
        start: False
        final: False
        micro:
          seq: [SecondaryTimeout2.timeout, SecondaryControl.toggle, SecondaryPreparesTimeout3.begin]
    - operating_priority:
        start: False
        final: False
        micro:
          seq: [SecondaryPreparesTimeout3.timeout, SecondaryControl.toggle, PriorityControl.toggle, PriorityTimeout4.begin]
    - interrupted:
        start: False
        final: False
        micro:
          seq: [PoliceInterrupt.police, PriorityPolice.police, SecondaryPolice.police]