name: Controller
components:
    v1: Valve
    v2: Valve
    v3: Valve
    v4: Valve
    m: Magnetic
    r: Radio
    lp: LowPower
operations:
    update:
        next: [activateAllValves]
        micro: [r.start, r.HTTPsetup, r.HTTPconnect, r.HTTPsend, r.HTTPreceive, r.HTTPdisconnect, r.HTTPdisable]
    wakeup:
        next: [update]
        micro:
          - xor:
            - [lp.wakeup]
            - [m.locked, m.unlocked, lp.setup]
    activateAllValves:
        next: [deactivateAllValves]
        micro: [v1.on, v2.on, v3.on, v4.on]
    deactivateAllValves:
        next: [sleep]
        micro: [v1.off, v2.off, v3.off, v4.off]
    sleep:
        next: [wakeup]
        final: False
        micro: [lp.setup, lp.sleep]

test_integration:
  ok:
    valid1: [r.start, r.HTTPsetup, r.HTTPconnect, r.HTTPsend, r.HTTPreceive, r.HTTPdisconnect, r.HTTPdisable, v1.on, v2.on, v3.on, v4.on, v1.off, v2.off, v3.off, v4.off, lp.setup, lp.sleep, lp.wakeup]
    valid3: [r.start, r.HTTPsetup, r.HTTPconnect, r.HTTPsend, r.HTTPreceive, r.HTTPdisconnect, r.HTTPdisable, v1.on, v2.on, v3.on, v4.on, v1.off, v2.off, v3.off, v4.off, lp.setup, lp.sleep, m.locked, m.unlocked, lp.setup]
    valid4: [r.start, r.HTTPsetup, r.HTTPconnect, r.HTTPsend, r.HTTPreceive, r.HTTPdisconnect, r.HTTPdisable, v1.on, v2.on, v3.on, v4.on, v1.off, v2.off, v3.off, v4.off]
  fail:
    invalid1: [m.locked, m.unlocked, v1.on, v2.on, v3.on, v4.on, r.start, r.HTTPsetup, r.HTTPconnect, r.HTTPsend, r.HTTPreceive] # missing r.HTTPdisconnect, r.HTTPdisable on macro behavior update
    invalid2: [m.locked, m.unlocked, v1.on, v2.on, v3.on, v4.on, r.start, r.HTTPsetup, r.HTTPconnect, r.HTTPsend, r.HTTPreceive, lp.sleep] # missing r.HTTPdisconnect, r.HTTPdisable on macro behavior update
    invalid3: [m.locked, m.unlocked, v1.on, v2.on, v3.on, v4.on, r.start, r.HTTPsetup, r.HTTPconnect, r.HTTPsend, r.HTTPreceive, r.HTTPdisconnect, r.HTTPdisable, v1.off, v2.off, v3.off, v4.off, lp.setup, lp.sleep, m.locked, m.unlocked] # missing 'lp.cancel' on macro behavior 'start'
    invalid4: [m.locked, m.unlocked, v1.on, v2.on, v3.on, v4.on, r.start, r.HTTPsetup, r.HTTPconnect, r.HTTPsend, r.HTTPreceive, r.HTTPdisconnect, r.HTTPdisable, v1.off, v2.off, v3.off, v4.off, lp.setup, lp.sleep, lp.wakeup] # missing 'lp.cancel' on macro behavior 'start'
    invalid5: [m.locked, v1.on, v2.on, v3.on, v4.on, r.start, r.HTTPsetup, r.HTTPconnect, r.HTTPsend, r.HTTPreceive, r.HTTPdisconnect, r.HTTPdisable, v1.off, v2.off, v3.off, v4.off, lp.setup, lp.sleep, lp.wakeup] # missing 'm.unlocked' on macro behavior 'start'
    invalid6: [m.locked, m.unlocked]
    invalid7: false
    invalidfinal1: [r.start, r.HTTPsetup, r.HTTPconnect, r.HTTPsend, r.HTTPreceive, r.HTTPdisconnect, r.HTTPdisable, v1.on, v2.on, v3.on, v4.on, v1.off, v2.off, v3.off, v4.off, lp.setup, lp.sleep]
    empty: []