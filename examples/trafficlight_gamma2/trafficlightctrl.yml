# Since we don't have any state information, we need explicit events for changing from normal to
# interrupt and vice-versa. Otherwise we could have wrong traces like changing from normal_green
# to interrupted_blinkingyellow [macro] fired by a BlinkingYellowTimeout3 event [micro].

device:
  name: TrafficLightCtrl
  behavior:
    # normal
    - [normal_entry0, normal_green]
    - [normal_red, normal_green]
    - [normal_green, normal_yellow]
    - [normal_yellow, normal_red]
    # normal -> interrupted
    - [normal_entry0, interrupted_entry1]
    - [normal_entry2, interrupted_entry1]
    - [normal_red, interrupted_entry1]
    - [normal_green, interrupted_entry1]
    - [normal_yellow, interrupted_entry1]
    - [interrupted_entry1, interrupted_black]
    # interrupted -> normal
    - [interrupted_blinkingyellow, normal_entry2]
    - [interrupted_black, normal_entry2]
    - [interrupted_entry1, normal_entry2]
    - [normal_entry2, normal_green]
    # interrupted
    - [interrupted_blinkingyellow, interrupted_black]
    - [interrupted_black, interrupted_blinkingyellow]
  components:
    PoliceInterrupt : PoliceInterrupt # input
    Control: Control # input
    BlinkingYellowTimeout3: Timer
    BlackTimeout4: Timer
    LightCommands: LightCommands # output
  events:
    - normal_entry0:
        start: True
        final: True
        micro: LightCommands.displayRed
    - normal_entry2:
        start: False
        final: True
        micro:
          seq: [PoliceInterrupt.off, LightCommands.displayRed]
    - normal_red:
        start: False
        final: True
        micro:
          seq: [Control.toggle, LightCommands.displayRed]
    - normal_green:
        start: False
        final: True
        micro: [Control.toggle, LightCommands.displayGreen]
    - normal_yellow:
        start: False
        final: True
        micro: [Control.toggle, LightCommands.displayYellow]
    - interrupted_entry1:
        start: False
        final: True
        micro:
          seq: [PoliceInterrupt.on, LightCommands.displayYellow]
    - interrupted_blinkingyellow:
        start: False
        final: True
        micro:
          seq: [BlackTimeout4.timeout, LightCommands.displayYellow]
    - interrupted_black:
        start: False
        final: True
        micro:
          seq: [BlinkingYellowTimeout3.timeout, LightCommands.displayNone]
