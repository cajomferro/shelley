device:
  name: TrafficLightCtrl
  behavior:
    # normal
    - [normal_red, normal_green]
    - [normal_green, normal_yellow]
    - [normal_yellow, normal_red]
    # normal -> interrupted
    - [normal_red, normal_to_interrupted]
    - [normal_green, normal_to_interrupted]
    - [normal_yellow, normal_to_interrupted]
    # interrupted -> normal
    - [interrupted_blinkingyellow, interrupted_to_normal]
    - [interrupted_black, interrupted_to_normal]
    - [interrupted_to_normal, normal_green]
    # interrupted
    - [normal_to_interrupted, interrupted_black]
    - [interrupted_blinkingyellow, interrupted_black]
    - [interrupted_black, interrupted_blinkingyellow]
  components:
    PoliceInterrupt : PoliceInterrupt # input
    Control: Control # input
    BlinkingYellowTimeout3: Timer
    BlackTimeout4: Timer
    LightCommands: LightCommands # output
  events:
    - interrupted_to_normal:
        start: False
        final: True
        micro:
          seq:
            - PoliceInterrupt.police # input
            - BlinkingYellowTimeout3.end   # cancel any timer still active
            - BlackTimeout4.end  # cancel any timer still active
            - LightCommands.displayRed
    - normal_red:
        start: True
        final: True
        micro:
          seq:
            - Control.toggle
            - LightCommands.displayRed
    - normal_green:
        start: False
        final: False
        micro: [Control.toggle, LightCommands.displayGreen]
    - normal_yellow:
        start: False
        final: False
        micro: [Control.toggle, LightCommands.displayYellow]
    - normal_to_interrupted:
        start: False
        final: False
        micro:
          seq:
            - PoliceInterrupt.police
            - LightCommands.displayYellow
            - BlinkingYellowTimeout3.begin
    - interrupted_blinkingyellow:
        start: False
        final: False
        micro:
          seq:
            - BlackTimeout4.timeout
            - LightCommands.displayYellow
            - BlinkingYellowTimeout3.begin
    - interrupted_black:
        start: False
        final: False
        micro:
          seq:
            - BlinkingYellowTimeout3.timeout
            - LightCommands.displayNone
            - BlackTimeout4.begin
