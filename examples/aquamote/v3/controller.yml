device:
  name: Controller
  start_events: [start]
  behavior:
    - [start, update]
    - [wakeup, update]
    - [update, runValves]
    - [runValves, sleep]
    - [sleep, start]
    - [sleep, wakeup]
  components:
    v: ValveHandlerTimer
    m: Magnetic
    radio: WiFiHTTP
    lp: LowPower
  events:
    - start:
        start: True
        final: False
        micro: [m.locked, m.unlocked, lp.cancel]
    - wakeup:
        final: False
        micro: [lp.wakeup]
    - update:
        final: False
        micro: [radio.started]
    - runValves:
        final: False
        micro: [v.v1, v.v2, v.v3, v.v4]
    - sleep:
        final: True
        micro: [lp.setup, lp.sleep]

test_micro:
  ok:
    valid1: [m.locked, m.unlocked, lp.cancel, radio.started, radio.send, radio.ok, radio.stop, v.v1, v.v2, v.v3, v.v4, lp.setup, lp.sleep]
    valid2: [m.locked, m.unlocked, lp.cancel, radio.started, radio.send, radio.ok, radio.stop, v.v1, v.v2, v.v3, v.v4, lp.setup, lp.sleep, m.locked, m.unlocked, lp.cancel, radio.started, radio.send, radio.ok, radio.stop, v.v1, v.v2, v.v3, v.v4, lp.setup, lp.sleep]
  fail:
    invalid1a: [m.locked, m.unlocked, lp.cancel, rs.send, v.v1, v.v2, v.v3, v.v4, lp.setup, lp.sleep, lp.wakeup] # missing rs.ok on macro behavior update
    invalid1b: [m.locked, m.unlocked, rs.send, rs.ok, v.v1, v.v2, v.v3, v.v4, lp.setup, lp.sleep, lp.wakeup] # missing 'lp.cancel' on macro behavior 'start'
    invalid1c: [m.locked, lp.cancel, rs.send, rs.ok, v.v1, v.v2, v.v3, v.v4, lp.setup, lp.sleep, lp.wakeup] # missing 'm.unlocked' on macro behavior 'start'
    invalid1d: [m.locked, m.unlocked, lp.cancel, rs.send, rs.ok, v.v1, v.v2, v.v3, v.v4, lp.setup, lp.sleep, lp.wakeup] # wakeup is not final
    invalid2a: [m.locked, m.unlocked, lp.cancel, rs.send, v.v1, v.v2, v.v3, v.v4, lp.sleep, m.locked, m.unlocked, lp.cancel] # missing rs.ok on macro behavior update
    invalid2b: [m.locked, m.unlocked, rs.send, rs.ok, v.v1, v.v2, v.v3, v.v4, lp.sleep, m.locked, m.unlocked, lp.cancel] # missing 'lp.cancel' on macro behavior 'start'
    invalid3: [m.locked, m.unlocked]
    invalid4: [m.locked, m.unlocked, lp.cancel, rs.send, rs.ok, v.v1, v.v2, v.v3, v.v4]
    invalid5: [m.locked, m.unlocked, lp.cancel]

    invalid7: false