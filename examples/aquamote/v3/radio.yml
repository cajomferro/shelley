#device:
#  name: RadioSimplest
#  start_events: [send]
#  behavior:
#    - [send, ?] # como é que poderia fazer para só enviar 1x?
#  components:
#      rs: RadioSimple
#  triggers:
#    send: [rs.start, rs.send, rs.receive, rs.stop]

device:
  name: Radio
  components:
      hc: HTTPClient
      wc: WiFiClient
  events:
    - started:
        start: True
        final: False
        micro: [wc.joined, wc.connected, hc.connected]
    - notconnected:
        start: True
        final: True
        micro:
          xor:
            - [wc.joined, wc.connected, hc.connect_failed]
            - xor:
              - [wc.joined, wc.connection_timeout]
              - [wc.ssid_failed]
    - send:
        final: False
        micro:
          xor:
            - hc.get
            - hc.post
    - ok:
        final: False
        micro: [wc.print_data_ready, hc.response200]
    - error:
        final: True
        micro:
          xor:
            - [wc.print_data_ready, hc.response401]
            - xor:
              - [wc.print_data_ready, hc.response401]
              - xor:
                - [wc.print_data_ready, hc.response404]
                - xor:
                  - [wc.print_data_ready, hc.response500]
                  - wc.print_timeout
    - stopped:
        final: True
        micro: [wc.disconnected, hc.disconnected, wc.ssid_left]
  behavior:
    - [started, send]
    - [notconnected, started]
    - [notconnected, notconnected]
    - [send, stopped]
    - [send, ok]
    - [send, error]
    - [error, send]
    - [ok, send]
    - [ok, stopped]
    - [error, stopped]
    - [stopped, started]
    - [stopped, notconnected]


#test_micro:
#  ok:
#    valid1: [rs.start, rs.send]
#    valid2: [rs.start, rs.send, rs.receive, rs.stop]
#    empty: []
#  failed:
#    invalid1: [rs.start]
#    invalid2: [rs.send]
#    invalid3: [rs.start, rs.receive, rs.stop]
#    invalid4: [rs.start, rs.send, s.stop]
#    invalid5: [rs.start, rs.send, rs.receive]
#    invalid6: [rs.send, rs.receive, rs.stop]
#    # invalid7: [rs.start, rs.send, rs.receive, rs.stop, rs.start, rs.send, rs.receive, rs.stop] # comment this to be more strict
#    invalid8: false