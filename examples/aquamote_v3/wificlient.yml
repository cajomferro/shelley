# LINK?
# disconnected event might be external (device error) or internal (user called disconnect() function)
device:
  name: WiFiClient
  events:
    - ssid_joined:
        start: True
        final: False
    - ssid_failed:
        start: True
        final: True
    - ssid_left:
        start: True
        final: True
    - print_timeout:
        start: True
        final: False
    - print_data_ready:
        start: True
        final: False
    - connected:
        start: True
        final: False
    - disconnected:
        start: True
        final: False
    - connection_timeout:
        start: True
        final: True
  behavior:
    - [connection_timeout, connected]
    # before "print_timeout" or "print_data_ready" or "print_disconnected":
    # client.print(String("GET ") + url + " HTTP/1.1\r\n" +
    #                 "Host: " + host + "\r\n" +
    #                 "Connection: close\r\n\r\n");
    #    while (client.available() == 0) {
    #        if (millis() - timeout > 5000) {
    #            Serial.println(">>> Client Timeout !");
    #            client.stop();
    #            return;
    #        }
    #    // Read all the lines of the reply from server and print them to Serial
    #    while(client.available()) {
    #        String line = client.readStringUntil('\r');
    #        Serial.print(line);
    #    }
    - [ssid_joined, connected]
    - [ssid_joined, connection_timeout]
    - [connection_timeout, ssid_failed]
    - [connection_timeout, ssid_joined]
    - [ssid_joined, ssid_left]
    - [ssid_left, ssid_joined]
    - [ssid_left, ssid_failed]
    - [ssid_failed, ssid_failed]
    - [ssid_failed, ssid_joined]
    - [connected, disconnected]
    - [connected, print_timeout]
    - [connected, print_data_ready]
    - [print_data_ready, print_data_ready]
    - [print_timeout, print_timeout]
    - [print_data_ready, disconnected]
    - [print_data_ready, print_timeout]
    - [print_timeout, disconnected]
    - [disconnected, connected]
    - [disconnected, connection_timeout]
    - [disconnected, ssid_left]

## before "print":
## client.print(String("GET ") + url + " HTTP/1.1\r\n" +
##                 "Host: " + host + "\r\n" +
##                 "Connection: close\r\n\r\n");
#    - [connected, print] # data has been written
#    - [connection_timeout, connected]
## before "print_timeout" or "print_data_ready":
##    while (client.available() == 0) {
##        if (millis() - timeout > 5000) {
##            Serial.println(">>> Client Timeout !");
##            client.stop();
##            return;
##        }
##    // Read all the lines of the reply from server and print them to Serial
##    while(client.available()) {
##        String line = client.readStringUntil('\r');
##        Serial.print(line);
##    }
#    - [print, print_timeout]
#    - [print, print_data_ready]
#    - [print_data_ready, print]
#    - [print_timeout, print]
#    - [print, disconnect]
#    - [print_data_ready, disconnect]
#    - [print_timeout, disconnect]

#test_macro:
#  ok:
#    connect_failed: [connect, connect_failed]
#    connect: [connect]
#    getok: [connect, get, response200, disconnect]
#    postok: [connect, post, response200, disconnect]
#    get2x: [connect, get, response404, get, response200, disconnect]
#    get2x_nodisconnect: [connect, get, response404, get, response200] # disconnect missing but still valid
#    empty: []
#  fail:
#    invalid1: [get]
#    invalid2: [post]
#    invalid3: [response200]
#    invalid4: [response404]
#    invalid5: [response500]
#    invalid6: [disconnect]
#    invalid7: [connect_failed]
#    get2x_noresponse: [connect, get, get, response200, disconnect] # response200 missing
